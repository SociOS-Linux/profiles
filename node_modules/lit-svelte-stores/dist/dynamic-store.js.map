{"version":3,"file":"dynamic-store.js","sourceRoot":"","sources":["../src/dynamic-store.ts"],"names":[],"mappings":"AAGA;;GAEG;AACH,MAAM,OAAO,YAAY;IASvB,YAAsB,IAAQ,EAAY,QAA2B;QAA/C,SAAI,GAAJ,IAAI,CAAI;QAAY,aAAQ,GAAR,QAAQ,CAAmB;QACnE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;IAED,UAAU;QACR,IAAI,CAAC,WAAW,EAAE,CAAC;IACrB,CAAC;IAED,gBAAgB;QACd,IAAI,CAAC,YAAY,EAAE,CAAC;IACtB,CAAC;IAED,WAAW;QACT,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAE9B,IAAI,KAAK,KAAK,IAAI,CAAC,cAAc,EAAE;YACjC,IAAI,IAAI,CAAC,YAAY;gBAAE,IAAI,CAAC,YAAY,EAAE,CAAC;YAE3C,IAAI,KAAK,EAAE;gBACT,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,KAAK,EAAE,EAAE;oBAC5C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;oBACnB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;gBAC5B,CAAC,CAAC,CAAC;aACJ;SACF;QAED,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;IAC9B,CAAC;CACF","sourcesContent":["import { Readable, Unsubscriber } from \"svelte/store\";\nimport { ReactiveController, ReactiveElement } from \"lit\";\n\n/**\n * Tracks a changing store, derived at each update\n */\nexport class DynamicStore<V, El extends ReactiveElement>\n  implements ReactiveController\n{\n  value!: V;\n\n  public _unsubscribe!: Unsubscriber;\n\n  private _previousStore: Readable<V> | undefined;\n\n  constructor(protected host: El, protected getStore: () => Readable<V>) {\n    host.addController(this);\n  }\n\n  hostUpdate() {\n    this.resubscribe();\n  }\n\n  hostDisconnected() {\n    this._unsubscribe();\n  }\n\n  resubscribe() {\n    const store = this.getStore();\n\n    if (store !== this._previousStore) {\n      if (this._unsubscribe) this._unsubscribe();\n\n      if (store) {\n        this._unsubscribe = store.subscribe((value) => {\n          this.value = value;\n          this.host.requestUpdate();\n        });\n      }\n    }\n\n    this._previousStore = store;\n  }\n}\n"]}